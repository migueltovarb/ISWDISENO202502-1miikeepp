<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CRUD Vehículos</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 24px; }
    h1 { margin-top: 0; }
    form, table { margin-top: 16px; }
    input, button { padding: 8px; margin: 4px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    tr.selected { background: #f0f8ff; }
  </style>
</head>
<body>
  <h1>CRUD de Vehículos</h1>
  <p>API: <code>http://localhost:8080/api/vehicles</code></p>

  <section>
    <h2>Listado</h2>
    <button id="reload">Recargar</button>
    <table>
      <thead>
        <tr>
          <th>Placa</th><th>Marca</th><th>Modelo</th><th>Año</th><th>Color</th><th>ID</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
  </section>

  <section>
    <h2>Crear / Editar</h2>
    <form id="form">
      <input id="plate" placeholder="Placa" required maxlength="20" />
      <input id="brand" placeholder="Marca" required maxlength="50" />
      <input id="model" placeholder="Modelo" required maxlength="50" />
      <input id="year" placeholder="Año" type="number" min="1900" />
      <input id="color" placeholder="Color" required maxlength="30" />
      <button type="submit">Guardar</button>
      <button type="button" id="clear">Limpiar selección</button>
      <button type="button" id="remove">Eliminar seleccionado</button>
    </form>
    <p id="status"></p>
  </section>

  <script>
    const API = 'http://localhost:8080/api/vehicles';
    const rows = document.getElementById('rows');
    const status = document.getElementById('status');
    let selected = null;

    async function load() {
      status.textContent = '';
      rows.innerHTML = '';
      const res = await fetch(API);
      const data = await res.json();
      for (const v of data) {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${v.plateNumber}</td><td>${v.brand}</td><td>${v.model}</td><td>${v.year}</td><td>${v.color}</td><td>${v.id}</td>`;
        tr.onclick = () => select(v, tr);
        rows.appendChild(tr);
      }
    }

    function select(v, tr) {
      for (const r of rows.querySelectorAll('tr')) r.classList.remove('selected');
      tr.classList.add('selected');
      selected = v;
      document.getElementById('plate').value = v.plateNumber || '';
      document.getElementById('brand').value = v.brand || '';
      document.getElementById('model').value = v.model || '';
      document.getElementById('year').value = v.year || '';
      document.getElementById('color').value = v.color || '';
    }

    document.getElementById('reload').onclick = load;

    document.getElementById('form').onsubmit = async (e) => {
      e.preventDefault();
      const payload = {
        plateNumber: document.getElementById('plate').value.trim(),
        brand: document.getElementById('brand').value.trim(),
        model: document.getElementById('model').value.trim(),
        year: Number(document.getElementById('year').value || 0),
        color: document.getElementById('color').value.trim()
      };
      try {
        let res;
        if (selected && selected.id) {
          res = await fetch(`${API}/${selected.id}`, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
        } else {
          res = await fetch(API, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
        }
        if (!res.ok) throw new Error(`${res.status}`);
        status.textContent = 'Guardado';
        selected = null;
        document.getElementById('form').reset();
        await load();
      } catch (err) {
        status.textContent = `Error: ${err.message}`;
      }
    };

    document.getElementById('clear').onclick = () => {
      selected = null;
      document.getElementById('form').reset();
      for (const r of rows.querySelectorAll('tr')) r.classList.remove('selected');
    };

    document.getElementById('remove').onclick = async () => {
      if (!selected || !selected.id) return;
      try {
        const res = await fetch(`${API}/${selected.id}`, { method: 'DELETE' });
        if (!res.ok) throw new Error(`${res.status}`);
        status.textContent = 'Eliminado';
        selected = null;
        await load();
      } catch (err) {
        status.textContent = `Error: ${err.message}`;
      }
    };

    load();
  </script>
</body>
</html>

